<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n - Validaci√≥n Completa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #1f2937;
            --secondary: #4338ca;
            --accent: #059669;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto p-6">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">
                <i class="fas fa-clipboard-check text-blue-600 mr-3"></i>
                Validaci√≥n del Sistema de Gesti√≥n
            </h1>
            <p class="text-gray-600 mb-6">Verificaci√≥n completa de todos los m√≥dulos y funcionalidades</p>
            
            <button id="run-tests" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium">
                <i class="fas fa-play mr-2"></i>Ejecutar Validaci√≥n
            </button>
        </div>

        <div id="test-results" class="space-y-4"></div>
    </div>

    <!-- Include all data files -->
    <script src="js/data/users.js"></script>
    <script src="js/data/menu.js"></script>
    <script src="js/data/orders.js"></script>

    <!-- Include utility modules -->
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>

    <!-- Include feature modules -->
    <script src="js/modules/admin.js"></script>
    <script src="js/modules/kitchen.js"></script>
    <script src="js/modules/cashier.js"></script>
    <script src="js/modules/waiter.js"></script>

    <!-- Include main app -->
    <script src="js/app.js"></script>

    <script>
        class SystemValidator {
            constructor() {
                this.results = [];
                this.testsRun = 0;
                this.testsPassed = 0;
            }

            log(message, type = 'info') {
                console.log(`[${type.toUpperCase()}] ${message}`);
                this.results.push({ message, type, timestamp: new Date().toISOString() });
            }

            test(description, testFunction) {
                this.testsRun++;
                try {
                    const result = testFunction();
                    if (result) {
                        this.testsPassed++;
                        this.log(`‚úÖ ${description}`, 'success');
                        return true;
                    } else {
                        this.log(`‚ùå ${description} - Test failed`, 'error');
                        return false;
                    }
                } catch (error) {
                    this.log(`‚ùå ${description} - Error: ${error.message}`, 'error');
                    return false;
                }
            }

            async runValidation() {
                this.log('üöÄ Iniciando validaci√≥n del sistema...', 'info');
                
                // Test data files
                this.log('üìä Validando archivos de datos...', 'info');
                this.test('Users data loaded', () => window.users && Array.isArray(window.users) && window.users.length > 0);
                this.test('Menu data loaded', () => window.menu && Array.isArray(window.menu) && window.menu.length > 0);
                this.test('Orders data loaded', () => window.orders && Array.isArray(window.orders));

                // Test utility modules
                this.log('üîß Validando m√≥dulos de utilidad...', 'info');
                this.test('Utils module loaded', () => typeof window.Utils === 'object');
                this.test('Utils.formatTime function', () => typeof window.Utils.formatTime === 'function');
                this.test('Utils.showNotification function', () => typeof window.Utils.showNotification === 'function');
                this.test('Auth module loaded', () => typeof window.Auth === 'object');
                this.test('Auth.login function', () => typeof window.Auth.login === 'function');
                this.test('Auth.logout function', () => typeof window.Auth.logout === 'function');

                // Test feature modules
                this.log('üì± Validando m√≥dulos de funcionalidad...', 'info');
                this.test('AdminModule loaded', () => typeof window.AdminModule === 'object');
                this.test('AdminModule.showView function', () => typeof window.AdminModule.showView === 'function');
                this.test('KitchenModule loaded', () => typeof window.KitchenModule === 'object');
                this.test('KitchenModule.showView function', () => typeof window.KitchenModule.showView === 'function');
                this.test('CashierModule loaded', () => typeof window.CashierModule === 'object');
                this.test('CashierModule.showView function', () => typeof window.CashierModule.showView === 'function');
                this.test('WaiterModule loaded', () => typeof window.WaiterModule === 'object');
                this.test('WaiterModule.showView function', () => typeof window.WaiterModule.showView === 'function');

                // Test main app
                this.log('üè† Validando aplicaci√≥n principal...', 'info');
                this.test('App module loaded', () => typeof window.App === 'object');
                this.test('App.init function', () => typeof window.App.init === 'function');

                // Test user roles
                this.log('üë• Validando roles de usuario...', 'info');
                const adminUser = window.users.find(u => u.role === 'admin');
                const waiterUser = window.users.find(u => u.role === 'waiter');
                const kitchenUser = window.users.find(u => u.role === 'kitchen');
                const cashierUser = window.users.find(u => u.role === 'cashier');

                this.test('Admin user exists', () => !!adminUser);
                this.test('Waiter user exists', () => !!waiterUser);
                this.test('Kitchen user exists', () => !!kitchenUser);
                this.test('Cashier user exists', () => !!cashierUser);

                // Test menu categories
                this.log('üçΩÔ∏è Validando men√∫...', 'info');
                const menuCategories = [...new Set(window.menu.map(item => item.category))];
                this.test('Menu has multiple categories', () => menuCategories.length > 1);
                this.test('Menu items have required fields', () => {
                    return window.menu.every(item => 
                        item.id && item.name && item.price && item.category
                    );
                });

                // Test module interactions
                this.log('üîÑ Validando interacciones entre m√≥dulos...', 'info');
                this.test('WaiterModule can select table', () => typeof window.WaiterModule.selectTable === 'function');
                this.test('WaiterModule can add to order', () => typeof window.WaiterModule.addToCurrentOrder === 'function');
                this.test('CashierModule can process payment', () => typeof window.CashierModule.processPayment === 'function');
                this.test('KitchenModule can update order status', () => typeof window.KitchenModule.updateOrderStatus === 'function');

                // Test authentication flow
                this.log('üîê Validando flujo de autenticaci√≥n...', 'info');
                this.test('Can authenticate admin user', () => {
                    const result = window.Auth.login('admin', 'admin123');
                    window.Auth.logout(); // Clean up
                    return result;
                });

                // Final results
                this.log('üìà Validaci√≥n completada', 'info');
                this.log(`Total de pruebas: ${this.testsRun}`, 'info');
                this.log(`Pruebas exitosas: ${this.testsPassed}`, 'success');
                this.log(`Pruebas fallidas: ${this.testsRun - this.testsPassed}`, this.testsPassed === this.testsRun ? 'success' : 'error');
                
                const successRate = Math.round((this.testsPassed / this.testsRun) * 100);
                this.log(`Tasa de √©xito: ${successRate}%`, successRate === 100 ? 'success' : 'warning');

                this.displayResults();
            }

            displayResults() {
                const container = document.getElementById('test-results');
                const summary = document.createElement('div');
                
                const successRate = Math.round((this.testsPassed / this.testsRun) * 100);
                const isSuccess = successRate === 100;

                summary.className = `bg-white rounded-lg shadow-lg p-6 ${isSuccess ? 'border-l-4 border-green-500' : 'border-l-4 border-yellow-500'}`;
                summary.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold text-gray-800">
                            <i class="fas ${isSuccess ? 'fa-check-circle text-green-500' : 'fa-exclamation-triangle text-yellow-500'} mr-2"></i>
                            Resumen de Validaci√≥n
                        </h2>
                        <div class="text-2xl font-bold ${isSuccess ? 'text-green-600' : 'text-yellow-600'}">${successRate}%</div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <div class="text-2xl font-bold text-blue-600">${this.testsRun}</div>
                            <div class="text-sm text-gray-600">Total Pruebas</div>
                        </div>
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <div class="text-2xl font-bold text-green-600">${this.testsPassed}</div>
                            <div class="text-sm text-gray-600">Exitosas</div>
                        </div>
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <div class="text-2xl font-bold text-red-600">${this.testsRun - this.testsPassed}</div>
                            <div class="text-sm text-gray-600">Fallidas</div>
                        </div>
                    </div>
                    ${isSuccess ? 
                        '<div class="bg-green-50 border border-green-200 rounded-lg p-4"><i class="fas fa-check-circle text-green-500 mr-2"></i><strong>¬°Sistema validado exitosamente!</strong> Todos los m√≥dulos est√°n funcionando correctamente.</div>' :
                        '<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4"><i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i><strong>Validaci√≥n parcial.</strong> Algunos m√≥dulos necesitan revisi√≥n.</div>'
                    }
                `;

                container.appendChild(summary);

                // Detailed results
                const details = document.createElement('div');
                details.className = 'bg-white rounded-lg shadow-lg p-6';
                details.innerHTML = `
                    <h3 class="text-lg font-bold text-gray-800 mb-4">
                        <i class="fas fa-list-ul mr-2"></i>Detalles de Validaci√≥n
                    </h3>
                    <div class="space-y-2 max-h-96 overflow-y-auto">
                        ${this.results.map(result => `
                            <div class="flex items-center p-3 rounded-lg ${this.getResultClass(result.type)}">
                                <span class="flex-1 text-sm">${result.message}</span>
                                <span class="text-xs text-gray-500">${new Date(result.timestamp).toLocaleTimeString()}</span>
                            </div>
                        `).join('')}
                    </div>
                `;

                container.appendChild(details);
            }

            getResultClass(type) {
                const classes = {
                    'success': 'bg-green-50 border border-green-200 text-green-800',
                    'error': 'bg-red-50 border border-red-200 text-red-800',
                    'warning': 'bg-yellow-50 border border-yellow-200 text-yellow-800',
                    'info': 'bg-blue-50 border border-blue-200 text-blue-800'
                };
                return classes[type] || 'bg-gray-50 border border-gray-200 text-gray-800';
            }
        }

        // Initialize and run validation
        document.addEventListener('DOMContentLoaded', () => {
            const validator = new SystemValidator();
            
            document.getElementById('run-tests').addEventListener('click', () => {
                document.getElementById('test-results').innerHTML = '';
                validator.results = [];
                validator.testsRun = 0;
                validator.testsPassed = 0;
                validator.runValidation();
            });
        });
    </script>
</body>
</html>
