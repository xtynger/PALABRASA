<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Testing - Restaurant Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .test-result { padding: 10px; margin: 5px 0; border-radius: 5px; }
        .test-pass { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .test-fail { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .test-pending { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaae; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-6">
        <h1 class="text-3xl font-bold mb-6 text-center">Restaurant Management System - Module Testing</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Data Loading Tests -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">Data Module Tests</h2>
                <div id="data-tests"></div>
            </div>
            
            <!-- Core Module Tests -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">Core Module Tests</h2>
                <div id="core-tests"></div>
            </div>
            
            <!-- Role Module Tests -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">Role Module Tests</h2>
                <div id="role-tests"></div>
            </div>
            
            <!-- Integration Tests -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">Integration Tests</h2>
                <div id="integration-tests"></div>
                <button id="run-integration" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Run Integration Tests
                </button>
            </div>
        </div>
        
        <!-- Console Output -->
        <div class="mt-6 bg-black text-green-400 p-4 rounded-lg font-mono text-sm h-64 overflow-y-auto">
            <div id="console-output"></div>
        </div>
    </div>

    <!-- Load Dependencies -->
    <script src="js/data/users.js"></script>
    <script src="js/data/menu.js"></script>
    <script src="js/data/orders.js"></script>
    
    <!-- Load Core Modules -->
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    
    <!-- Load Role Modules -->
    <script src="js/modules/admin.js"></script>
    <script src="js/modules/waiter.js"></script>
    <script src="js/modules/kitchen.js"></script>
    <script src="js/modules/cashier.js"></script>
    
    <!-- Load App Controller -->
    <script src="js/app.js"></script>

    <script>
        // Console output capture
        const consoleOutput = document.getElementById('console-output');
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'text-red-400' : type === 'warn' ? 'text-yellow-400' : 'text-green-400';
            consoleOutput.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        // Test result display
        function showTestResult(containerId, testName, passed, details = '') {
            const container = document.getElementById(containerId);
            const resultClass = passed ? 'test-pass' : 'test-fail';
            const icon = passed ? '✅' : '❌';
            container.innerHTML += `<div class="test-result ${resultClass}">${icon} ${testName}${details ? ': ' + details : ''}</div>`;
        }

        // Data Module Tests
        function testDataModules() {
            log('Testing data modules...');
            
            // Test users data
            const usersTest = window.users && Array.isArray(window.users) && window.users.length > 0;
            showTestResult('data-tests', 'Users Data', usersTest, usersTest ? `${window.users.length} users loaded` : 'Failed to load users');
            
            // Test menu data
            const menuTest = window.menu && Array.isArray(window.menu) && window.menu.length > 0;
            showTestResult('data-tests', 'Menu Data', menuTest, menuTest ? `${window.menu.length} items loaded` : 'Failed to load menu');
            
            // Test orders data
            const ordersTest = window.orders && Array.isArray(window.orders);
            showTestResult('data-tests', 'Orders Data', ordersTest, ordersTest ? `${window.orders.length} orders loaded` : 'Failed to load orders');
            
            log('Data module tests completed');
        }

        // Core Module Tests
        function testCoreModules() {
            log('Testing core modules...');
            
            // Test Utils module
            const utilsTest = window.Utils && typeof window.Utils.formatTime === 'function';
            showTestResult('core-tests', 'Utils Module', utilsTest);
            
            // Test Auth module
            const authTest = window.Auth && typeof window.Auth.login === 'function';
            showTestResult('core-tests', 'Auth Module', authTest);
            
            // Test App module
            const appTest = window.App && typeof window.App.init === 'function';
            showTestResult('core-tests', 'App Module', appTest);
            
            log('Core module tests completed');
        }

        // Role Module Tests
        function testRoleModules() {
            log('Testing role modules...');
            
            // Test Admin module
            const adminTest = window.AdminModule && typeof window.AdminModule.showView === 'function';
            showTestResult('role-tests', 'Admin Module', adminTest);
            
            // Test Waiter module
            const waiterTest = window.WaiterModule;
            showTestResult('role-tests', 'Waiter Module', !!waiterTest, waiterTest ? 'Loaded' : 'Failed to load');
            
            // Test Kitchen module
            const kitchenTest = window.KitchenModule && typeof window.KitchenModule.showView === 'function';
            showTestResult('role-tests', 'Kitchen Module', kitchenTest);
            
            // Test Cashier module
            const cashierTest = window.CashierModule && typeof window.CashierModule.showView === 'function';
            showTestResult('role-tests', 'Cashier Module', cashierTest);
            
            log('Role module tests completed');
        }

        // Integration Tests
        function testIntegration() {
            log('Running integration tests...');
            
            // Clear previous results
            document.getElementById('integration-tests').innerHTML = '';
            
            // Test login functionality
            try {
                const testUser = window.users[0]; // Use first user for testing
                if (testUser) {
                    const loginResult = window.Auth.login(testUser.username, testUser.password);
                    showTestResult('integration-tests', 'Login Test', loginResult, `Logged in as ${testUser.username}`);
                }
            } catch (error) {
                showTestResult('integration-tests', 'Login Test', false, error.message);
                log(`Login test error: ${error.message}`, 'error');
            }
            
            // Test module navigation
            try {
                if (window.App && window.App.init) {
                    window.App.init();
                    showTestResult('integration-tests', 'App Initialization', true);
                }
            } catch (error) {
                showTestResult('integration-tests', 'App Initialization', false, error.message);
                log(`App init error: ${error.message}`, 'error');
            }
            
            // Test Utils functions
            try {
                const timeTest = window.Utils.formatTime(new Date());
                const currencyTest = window.Utils.formatCurrency && window.Utils.formatCurrency(123.45);
                showTestResult('integration-tests', 'Utils Functions', !!timeTest, `Time format: ${timeTest}`);
            } catch (error) {
                showTestResult('integration-tests', 'Utils Functions', false, error.message);
                log(`Utils test error: ${error.message}`, 'error');
            }
            
            log('Integration tests completed');
        }

        // Run tests on page load
        window.addEventListener('load', () => {
            log('Starting module tests...');
            
            setTimeout(() => {
                testDataModules();
                testCoreModules();
                testRoleModules();
            }, 500);
        });

        // Integration test button
        document.getElementById('run-integration').addEventListener('click', testIntegration);

        // Catch and log all errors
        window.addEventListener('error', (event) => {
            log(`Error: ${event.error.message} at ${event.filename}:${event.lineno}`, 'error');
        });
    </script>
</body>
</html>
